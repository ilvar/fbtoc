<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FB TOC</title>
  <style>
    textarea {
      width: 100%;
      height: 600px;
    }
  </style>
</head>
<body>
  <label>Character count threshold</label>
  <input type="number" id="threshold" placeholder="Enter character count threshold here" value="500" />
  <button id="go">Generate</button>
  <textarea id="result" placeholder="Result will appear here (markdown)"></textarea>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>
  <script>
  function getPosts(username, next) {
    FB.api(next || "/me/posts", "get", {limit: 100}, function(response) {
      if (!response.error && response.data.length) {
        $result = $('#result');
        posts = _.filter(response.data, function(p) { return p.message && p.message.length > $("#threshold").val() });
        data = _.join(_.map(posts, function(p) {
          sentences = p.message.replace(/\n/g, " ").replace(/([.?!])\s*(?=[A-ZА-Я])/g, "$1|").split("|")
          header = sentences[0] + " _" + p.created_time.split("T")[0] + "_";
          rest = ""
          sentences.slice(1).forEach(function(s) {
            if (rest.length < 200) {
              rest += s + " ";
            }
          });
          path = username + "/posts/" + p.id.split("_")[1];
          return "* [" + header +"](https://www.facebook.com/" + path + ") " + rest;
        }), '\n')
        newVal = $result.val() + "\n" + data + "\n"
        $result.val(newVal.trim());
        setTimeout(function() {
          getPosts(username, response.paging.next);
        }, 100);
      }
    });
  }

  window.fbAsyncInit = function() {
    FB.init({
      appId      : '1870833733194976',
      xfbml      : true,
      version    : 'v2.8'
    });

    $("#go").click(function() {
      FB.login(function(response){
        getPosts(response.authResponse.userID);
      }, {scope: 'user_posts'});
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
</body>
</html>